<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- <link rel="icon" href="%PUBLIC_URL%/Subata_logo.png" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="stylesheet" href="./live2d/waifu.css">
    <title></title>
  </head>
  <body>
    <div id="waifu">
			<div id="waifu-tips"></div>
			<canvas id="live2d" width="800" height="800"></canvas>
			<!-- <div id="waifu-tool">
				<span class="fa fa-lg fa-comment"></span>
				<span class="fa fa-lg fa-paper-plane"></span>
				<span class="fa fa-lg fa-user-circle"></span>
				<span class="fa fa-lg fa-street-view"></span>
				<span class="fa fa-lg fa-camera-retro"></span>
				<span class="fa fa-lg fa-info-circle"></span>
				<span class="fa fa-lg fa-times"></span>
			</div> -->
		</div>
    <script src="./message/msg.js"></script>
    <script src="./tools/util-node.js"></script>
    <script src="./live2d/live2d.min.js"></script>
    <script src="./live2d/waifu-tips-content.js"></script>
    <script src="./live2d/waifu-tips-mine.js"></script>
    <script>
            document.onkeydown = function(){
              var e = window.event || arguments[0];
              if(e.keyCode === 123){    //屏蔽F12
                  return false;
              }else if(e.ctrlKey && e.shiftKey && e.keyCode === 73){    //屏蔽Ctrl+Shift+I，等同于F12
                  return false;
              }else if(e.shiftKey && e.keyCode === 121){    //屏蔽Shift+F10，等同于鼠标右键
                  return false;
              }else if(e.keyCode === 122){ // F11
                return false;
              }
          }
    </script>
    <script>
          let timer = null
          let isDown = false, baseX, baseY
          let prveX = 0, prveY = 0 // 上次XY
          function initLive2d(){
            let live2d = window.location.href.split('?')[1]?.split('=')[1]
            document.title = live2d
            let modelPath = `./Resources/live2dModel/${live2d || 'shizuku'}/model.json`
            // console.log(modelPath)
            loadlive2d("live2d", modelPath);
          }
          initLive2d()
          setTimeout(() => {
            let live2dBox = document.getElementById('waifu')
            live2dBox.addEventListener('mousedown', (e)=>{
                    e.stopPropagation()
                    isDown = true 
                    baseX = e.clientX
                    baseY = e.clientY
                    // console.log(baseX, baseY)
            })
          }, 1000);

          document.addEventListener('mousemove',function(ev){
              if(isDown){
              const x = ev.screenX - baseX
              const y = ev.screenY - baseY
              //   console.log(x, y)
              if(prveX !== x || prveY !== y){
                  // console.log(x, y)
                  prveX = x
                  prveY = y
                  window.electronAPI.moveLive2d({
                      x, y
                  })
              }
              }
          })
          document.addEventListener('mouseup', ()=>{
              isDown = false
          })
    </script>
    <script src="./tools/dialog.js"></script>
    <script>
      window.electronAPI.saveTextLive2d((text)=>{
        window.alertText(text)
      })
    </script>
  </body>
</html> 
